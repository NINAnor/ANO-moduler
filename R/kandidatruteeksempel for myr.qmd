---
title: "Kandidatrute-eksempel for myr"
format: html
editor: visual
---

```{r setup}
#| message: false
#| 

library(tidyverse)
library(sf)
```

Read SSB 550x500m grid dataset

```{r readBig}
#| eval: false
#grid <- sf::read_sf("../data/SSB0500M_L/ruter500m_Norge.shp",
#                    quiet = T)

grid <- sf::read_sf("/data/P-Prosjekter2/412421_okologisk_tilstand_2024/Data/SSB0500M_L/ruter500m_Norge.shp",
                    quiet = T)

```

Sample 100 random cells to make it easier to read data

```{r slice}
#| eval: false
grid |>
  # Filter for Vestfold
  filter(Fylk2016 == "07") |>
  slice_sample(n = 100) |>
  saveRDS("../data/SSB500_sample.rds")
```

Read back inn

```{r import}
grid_sample <- readRDS("../data/SSB500_sample.rds")
```

Fylk2016 nr 16 is Sør Trøndelag. 07 is Vestfold.

```{r }


```

Read AR5 for Vestfold

```{r}
#| eval: false
ar5_vf <- read_sf("/data/R/GeoSpatialData/Topography/Norway_FKB/Original/Basisdata_39_Vestfold_25832_FKB-AR5_FGDB.gdb") |>
  st_transform(32633) |>
  mutate(Arealtype = case_match(
    arealtype,
    "60" ~ "Myr",
    "12" ~ "Samferdsel",
    "21" ~ "Fulldyrka mark",
    "23" ~ "Innmarksbeite",
    "30" ~ "Barskog",
    "50" ~ "Åpen mark",
    "81" ~ "Ferskvann",
    .default = arealtype
    
  ))

```

Intersect ar5 and ssb and get cells with some mire in them

```{r plot}
grid_sample1 <- grid_sample |>
  filter(Fylk2016 == "07") |>
  slice(35)

ar5_sample1 <- ar5_vf |>
  st_intersection(grid_sample1)

ar5_sample1 |>
  ggplot() +
  geom_sf() +
  geom_sf(data = ar5_sample1,
          aes(fill = Arealtype))

```
